{% extends 'management/base.html' %}

{% block title %}{{ form_title }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-6">

    <!-- Header -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold text-gray-800">{{ form_title }}</h1>
            <p class="text-sm text-gray-500 mt-1">จัดการ Pop-up โฆษณาหน้าแรก</p>
        </div>
        <a href="{% url 'management:popup_list' %}"
           class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition">
            ← กลับ
        </a>
    </div>

    <!-- Form -->
    <form method="post" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}

        <!-- Basic Info Card -->
        <div class="bg-white rounded-lg shadow p-6 border-l-4 border-blue-500">
            <div class="flex items-center mb-4">
                <svg class="w-6 h-6 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <h3 class="text-lg font-semibold text-gray-800">ข้อมูลพื้นฐาน</h3>
            </div>

            <!-- Title -->
            <div class="mb-4">
                <label for="id_title" class="block text-sm font-medium text-gray-700 mb-2">
                    หัวข้อ <span class="text-red-500">*</span>
                </label>
                <input type="text" name="title" id="id_title" value="{{ form.title.value|default:'' }}"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                       required>
                {% if form.title.errors %}
                <p class="mt-1 text-sm text-red-600">{{ form.title.errors.0 }}</p>
                {% endif %}
            </div>

            <!-- Image -->
            <div class="mb-4">
                <label for="id_image" class="block text-sm font-medium text-gray-700 mb-2">
                    รูปภาพ <span class="text-red-500">*</span>
                </label>
                {% if form.instance.image %}
                <div class="mb-2">
                    <img src="{{ form.instance.image.url }}" alt="Current" class="w-48 h-36 object-cover rounded border">
                    <p class="text-sm text-gray-500 mt-1">รูปภาพปัจจุบัน</p>
                </div>
                {% endif %}
                <input type="file" name="image" id="id_image" accept="image/*"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                       {% if not form.instance.image %}required{% endif %}>
                <p class="mt-1 text-sm text-gray-500">แนะนำขนาด 800x450 พิกเซล (อัตราส่วน 16:9)</p>
                {% if form.image.errors %}
                <p class="mt-1 text-sm text-red-600">{{ form.image.errors.0 }}</p>
                {% endif %}
            </div>
        </div>

        <!-- Link Card -->
        <div class="bg-white rounded-lg shadow p-6 border-l-4 border-green-500">
            <div class="flex items-center mb-4">
                <svg class="w-6 h-6 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                </svg>
                <h3 class="text-lg font-semibold text-gray-800">ลิงก์ (ไม่บังคับ)</h3>
            </div>

            <!-- Link URL -->
            <div class="mb-4">
                <label for="id_link_url" class="block text-sm font-medium text-gray-700 mb-2">
                    ลิงก์
                </label>
                <input type="text" name="link_url" id="id_link_url" value="{{ form.link_url.value|default:'' }}"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                       placeholder="/education/admission/ หรือ https://example.com">
                {% if form.link_url.errors %}
                <p class="mt-1 text-sm text-red-600">{{ form.link_url.errors.0 }}</p>
                {% endif %}
            </div>

            <!-- Link Text -->
            <div class="mb-4">
                <label for="id_link_text" class="block text-sm font-medium text-gray-700 mb-2">
                    ข้อความลิงก์
                </label>
                <input type="text" name="link_text" id="id_link_text" value="{{ form.link_text.value|default:'คลิกเพื่อดูรายละเอียด' }}"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                {% if form.link_text.errors %}
                <p class="mt-1 text-sm text-red-600">{{ form.link_text.errors.0 }}</p>
                {% endif %}
            </div>
        </div>

        <!-- Display Settings Card -->
        <div class="bg-white rounded-lg shadow p-6 border-l-4 border-purple-500">
            <div class="flex items-center mb-4">
                <svg class="w-6 h-6 text-purple-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path>
                </svg>
                <h3 class="text-lg font-semibold text-gray-800">การตั้งค่าการแสดงผล</h3>
            </div>

            <!-- Active Status -->
            <div class="mb-4">
                <div class="flex items-center">
                    <input type="checkbox" name="is_active" id="id_is_active" value="True"
                           {% if form.is_active.value %}checked{% endif %}
                           class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
                    <label for="id_is_active" class="ml-2 text-sm font-medium text-gray-700">
                        เปิดใช้งาน
                    </label>
                </div>
            </div>

            <!-- Date Range -->
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="id_start_date" class="block text-sm font-medium text-gray-700 mb-2">
                        วันที่เริ่มแสดง
                    </label>
                    <input type="datetime-local" name="start_date" id="id_start_date"
                           value="{{ form.start_date.value|date:'Y-m-d\TH:i'|default:'' }}"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                </div>
                <div>
                    <label for="id_end_date" class="block text-sm font-medium text-gray-700 mb-2">
                        วันที่สิ้นสุด
                    </label>
                    <input type="datetime-local" name="end_date" id="id_end_date"
                           value="{{ form.end_date.value|date:'Y-m-d\TH:i'|default:'' }}"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                </div>
            </div>

            <!-- Show Frequency -->
            <div class="mb-4">
                <label for="id_show_frequency" class="block text-sm font-medium text-gray-700 mb-2">
                    ความถี่การแสดง
                </label>
                <select name="show_frequency" id="id_show_frequency"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                    <option value="always" {% if form.show_frequency.value == 'always' %}selected{% endif %}>แสดงทุกครั้ง</option>
                    <option value="once_per_session" {% if form.show_frequency.value == 'once_per_session' or not form.show_frequency.value %}selected{% endif %}>แสดงครั้งเดียวต่อ Session</option>
                    <option value="once_per_day" {% if form.show_frequency.value == 'once_per_day' %}selected{% endif %}>แสดงครั้งเดียวต่อวัน</option>
                    <option value="once_forever" {% if form.show_frequency.value == 'once_forever' %}selected{% endif %}>แสดงครั้งเดียวตลอดกาล</option>
                </select>
            </div>

            <!-- Delays -->
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="id_show_delay" class="block text-sm font-medium text-gray-700 mb-2">
                        หน่วงเวลาก่อนแสดง (วินาที)
                    </label>
                    <input type="number" name="show_delay" id="id_show_delay" min="0" max="10"
                           value="{{ form.show_delay.value|default:2 }}"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                    <p class="mt-1 text-sm text-gray-500">0-10 วินาที</p>
                </div>
                <div>
                    <label for="id_auto_close_delay" class="block text-sm font-medium text-gray-700 mb-2">
                        ปิดอัตโนมัติหลังจาก (วินาที)
                    </label>
                    <input type="number" name="auto_close_delay" id="id_auto_close_delay" min="0"
                           value="{{ form.auto_close_delay.value|default:0 }}"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                    <p class="mt-1 text-sm text-gray-500">0 = ไม่ปิดอัตโนมัติ</p>
                </div>
            </div>

            <!-- Size -->
            <div class="mb-4">
                <label for="id_size" class="block text-sm font-medium text-gray-700 mb-2">
                    ขนาด Popup
                </label>
                <select name="size" id="id_size"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                    <option value="small" {% if form.size.value == 'small' %}selected{% endif %}>เล็ก (640x360) 16:9</option>
                    <option value="medium" {% if form.size.value == 'medium' or not form.size.value %}selected{% endif %}>กลาง (800x450) 16:9</option>
                    <option value="large" {% if form.size.value == 'large' %}selected{% endif %}>ใหญ่ (1280x720) 16:9</option>
                </select>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="flex items-center justify-end space-x-3 pb-6">
            <a href="{% url 'management:popup_list' %}"
               class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition">
                ยกเลิก
            </a>
            <button type="submit"
                    class="px-6 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                {{ submit_text }}
            </button>
        </div>
    </form>

</div>
{% endblock %}
